<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/jmx.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/jmx.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"jmxgodlz.xyz","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="前言今天开始我将会推出一系列关于复刻ChatGPT语言模型的博文。本系列将包括以下内容：  复刻ChatGPT语言模型系列-（一）基座模型选取 复刻ChatGPT语言模型系列-（二）参数高效微调 复刻ChatGPT语言模型系列-（三）指令学习微调 复刻ChatGPT语言模型系列-（四）文本生成解码 复刻ChatGPT语言模型系列-（五）强化学习RLHF 复刻ChatGPT语言模型系列-（六）LLM">
<meta property="og:type" content="article">
<meta property="og:title" content="复刻ChatGPT语言模型系列-（三）指令学习微调">
<meta property="og:url" content="https://jmxgodlz.xyz/2023/11/27/2023-11-27-%E5%A4%8D%E5%88%BBChatGPT%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%B3%BB%E5%88%97-%EF%BC%88%E4%B8%89%EF%BC%89%E6%8C%87%E4%BB%A4%E5%AD%A6%E4%B9%A0%E5%BE%AE%E8%B0%83/index.html">
<meta property="og:site_name" content="JMX Blog">
<meta property="og:description" content="前言今天开始我将会推出一系列关于复刻ChatGPT语言模型的博文。本系列将包括以下内容：  复刻ChatGPT语言模型系列-（一）基座模型选取 复刻ChatGPT语言模型系列-（二）参数高效微调 复刻ChatGPT语言模型系列-（三）指令学习微调 复刻ChatGPT语言模型系列-（四）文本生成解码 复刻ChatGPT语言模型系列-（五）强化学习RLHF 复刻ChatGPT语言模型系列-（六）LLM">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/U8rCwe.jpg">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/D1ydS4.jpg">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/iG1Jpl.jpg">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/nQn4XC.jpg">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/lNnTsV.jpg">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/VAshxp.jpg">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/TWTOXK.jpg">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/l0cYDW.jpg">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/FLAN V2.png">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/fawbSB.jpg">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/kyKMvo.jpg">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/jSx3zF.jpg">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/aFyvhA.jpg">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/mpwy0i.jpg">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/GDnq8i.jpg">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/YKy6ac.jpg">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/eQgUhJ.jpg">
<meta property="og:image" content="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1678929778941-333749e2-68da-44c8-a954-823c24d46b31.png">
<meta property="og:image" content="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1678930009706-a4b4d2e2-a907-4343-b88d-1692050685bd.png">
<meta property="og:image" content="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1678930044701-c9650557-be52-4c9e-b01d-4542a3f80894.png">
<meta property="og:image" content="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1678930304104-04bce2fd-db11-4e9d-92e6-85969e58ce52.png">
<meta property="og:image" content="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1678930536751-b6cede37-d525-4400-a030-41de09a270c6.png">
<meta property="og:image" content="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1678930577160-9a57dc5a-67a3-4fd0-bbae-542ec5ef3e28.png">
<meta property="og:image" content="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1678930860644-965f338d-2643-4190-b7bd-2acf5f800590.png">
<meta property="og:image" content="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1678931155516-4052a4ef-2c84-4f31-ba4e-5fb6210e0100.png">
<meta property="og:image" content="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1678931332011-847b3aa8-0f75-4641-98fe-6a7b4760aa94.png">
<meta property="og:image" content="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1678932643771-edefc746-8e8b-4ee5-9414-7218f8f583d5.png">
<meta property="og:image" content="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1680742099480-dd0ff89c-6119-449a-905e-0d17c3fbc25d.png">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/FXWY3N.jpg">
<meta property="og:image" content="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1680742185719-0c6cc145-8cb7-4872-af1d-ed77ec887232.png">
<meta property="og:image" content="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1680742088850-a710a98c-66f3-4ffd-b86f-4c64a10c722e.png">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/LXC1Sf.png">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/UPZNLB.jpg">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/sDnpOz.jpg">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/GLo6gU.jpg">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/s2rlnf.jpg">
<meta property="og:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/vltEZB.jpg">
<meta property="og:image" content="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1698369336569-00b7e779-837c-4696-be86-ae3deb3a0519.png">
<meta property="og:image" content="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1698371271658-a1d88555-3af6-475a-b5a2-d2449305391f.png">
<meta property="og:image" content="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1698372412696-95911981-1b9c-4910-afbc-0e75996f7de0.png">
<meta property="og:image" content="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1698373272442-4e31b2d5-d3c5-4692-b39d-1123467e2cfd.png">
<meta property="og:image" content="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1698374021569-08d8d4af-dfe9-4bc5-ae6e-87d12bb8d607.png">
<meta property="og:image" content="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1698399507466-cf31dbf8-0613-43eb-975a-cfca13de1aee.png">
<meta property="og:image" content="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1698399819132-7f0131b9-c0dd-48c0-a028-8a00465293c1.png">
<meta property="og:image" content="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1692751562367-607c2567-a00c-46cb-8f99-d6e758f8cd3b.png">
<meta property="article:published_time" content="2023-11-26T16:00:00.000Z">
<meta property="article:modified_time" content="2023-12-31T12:23:36.941Z">
<meta property="article:author" content="JMXGODLZZ">
<meta property="article:tag" content="NLP">
<meta property="article:tag" content="ChatGPT">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/U8rCwe.jpg">

<link rel="canonical" href="https://jmxgodlz.xyz/2023/11/27/2023-11-27-%E5%A4%8D%E5%88%BBChatGPT%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%B3%BB%E5%88%97-%EF%BC%88%E4%B8%89%EF%BC%89%E6%8C%87%E4%BB%A4%E5%AD%A6%E4%B9%A0%E5%BE%AE%E8%B0%83/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>复刻ChatGPT语言模型系列-（三）指令学习微调 | JMX Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">JMX Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-guestbook">

    <a href="/guestbook/" rel="section"><i class="fa fa-book fa-fw"></i>guestbook</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jmxgodlz.xyz/2023/11/27/2023-11-27-%E5%A4%8D%E5%88%BBChatGPT%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%B3%BB%E5%88%97-%EF%BC%88%E4%B8%89%EF%BC%89%E6%8C%87%E4%BB%A4%E5%AD%A6%E4%B9%A0%E5%BE%AE%E8%B0%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/jmx.png">
      <meta itemprop="name" content="JMXGODLZZ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JMX Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          复刻ChatGPT语言模型系列-（三）指令学习微调
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-11-27 00:00:00" itemprop="dateCreated datePublished" datetime="2023-11-27T00:00:00+08:00">2023-11-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-31 20:23:36" itemprop="dateModified" datetime="2023-12-31T20:23:36+08:00">2023-12-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">学习</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0/NLP/" itemprop="url" rel="index"><span itemprop="name">NLP</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0/NLP/ChatGPT/" itemprop="url" rel="index"><span itemprop="name">ChatGPT</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/11/27/2023-11-27-%E5%A4%8D%E5%88%BBChatGPT%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%B3%BB%E5%88%97-%EF%BC%88%E4%B8%89%EF%BC%89%E6%8C%87%E4%BB%A4%E5%AD%A6%E4%B9%A0%E5%BE%AE%E8%B0%83/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/11/27/2023-11-27-%E5%A4%8D%E5%88%BBChatGPT%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%B3%BB%E5%88%97-%EF%BC%88%E4%B8%89%EF%BC%89%E6%8C%87%E4%BB%A4%E5%AD%A6%E4%B9%A0%E5%BE%AE%E8%B0%83/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>14k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>12 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>今天开始我将会推出一系列关于复刻ChatGPT语言模型的博文。本系列将包括以下内容：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/627832567">复刻ChatGPT语言模型系列-（一）基座模型选取</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/663412945">复刻ChatGPT语言模型系列-（二）参数高效微调</a></li>
<li>复刻ChatGPT语言模型系列-（三）指令学习微调</li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/629909354">复刻ChatGPT语言模型系列-（四）文本生成解码</a></li>
<li>复刻ChatGPT语言模型系列-（五）强化学习RLHF</li>
<li>复刻ChatGPT语言模型系列-（六）LLM模型评估</li>
</ul>
<p>在大模型时代，指令微调已经成为了连接预训练模型与实际业务的重要桥梁。许多垂直领域模型，都是在预训练模型的基础上，通过针对性的指令微调，以适应特定的业务需求。</p>
<p>在这篇博客中，我们将聚焦于探讨指令微调的起源、目的和实践方法。我们将首先回顾指令微调的起源(FLAN)，探讨其在模型训练中的重要性。接着，我们会深入理解其主要目的——激发预训练模型的指令遵循能力。最后，我们将详细介绍指令微调的训练方法，包括如何获取多样性的数据、如何选择高质量数据和如何组合高质量的数据。</p>
<p>希望通过这篇博客，可以帮助大家对指令微调深入且全面的理解，并在实际工作中有效应用，以提升模型在特定业务场景下的性能。</p>
<p>文章结论如下:</p>
<ol>
<li><p>SFT的目的:激发预训练模型的指令遵循能力</p>
</li>
<li><p>SFT的关键做法:</p>
<ul>
<li><p>增加数据的多样性(数据中不同任务的类型)；</p>
</li>
<li><p>提高数据的质量(数据筛选指标:PPL/IFD)；</p>
</li>
<li><p>训练过程中加入COT的数据，以保持COT的能力和Zero-shot的能力；</p>
</li>
<li><p>与单一能力学习相比，多任务学习多种能力在低资源下有所改善，在高资源下有所下降</p>
</li>
</ul>
</li>
<li><p>SFT的优势:</p>
<ul>
<li>计算高效，用远小于预训练阶段的资源，完成业务模型的训练</li>
</ul>
</li>
</ol>
<span id="more"></span>
<h1 id="FLAN"><a href="#FLAN" class="headerlink" title="FLAN"></a>FLAN</h1><p>在FLAN系列的论文中，谷歌首次提出了指令学习的概念，通过自然语言描述的方式微调语言模型，可以显著的提升在未见过任务上的零样本表现，并且随着模型规模和指令数据的增加，模型的表现进一步提升。在这两篇的论文中，核心观点如下:</p>
<p><strong>(1) scaling the number of tasks (数据多样性很重要)</strong></p>
<p><strong>(2) scaling the model size (模型参数量很重要)</strong></p>
<p><strong>(3) finetuning on chain-of-thought data (数据质量很重要)</strong></p>
<h2 id="FLAN-V1"><a href="#FLAN-V1" class="headerlink" title="FLAN V1"></a>FLAN V1</h2><p>论文标题:FINETUNED LANGUAGE MODELS ARE ZERO-SHOT LEARNERS</p>
<p>论文链接:<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2109.01652.pdf">https://arxiv.org/pdf/2109.01652.pdf</a></p>
<p>这篇论文探索了一种简单的方法来提升语言模型的<strong>零样本学习能力</strong>。研究表明，指令微调在一系列通过指令描述的数据集上微调语言模型可以显著提高在未见过的任务上的零样本表现。</p>
<p>研究的主要结论为<strong>微调数据集的数量，模型规模和自然语言指令</strong>是指令微调成功的关键。</p>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/U8rCwe.jpg" alt="U8rCwe"></p>
<p><strong>研究背景</strong>:GPT3等LLM模型擅长Few-shot、不擅长Zero-shot</p>
<p><strong>推断原因</strong>:推断原因:没有Few-shot示例，模型难以在<strong>与预训练Prompt差距较大的任务上</strong>取得好的表现</p>
<p><strong>研究方法</strong>:NLP任务可以通过自然语言指令来描述</p>
<h3 id="数据集详情"><a href="#数据集详情" class="headerlink" title="数据集详情"></a>数据集详情</h3><p><strong>动机</strong>:提高LLM响应NLP指令的能力</p>
<p><strong>方法</strong>:将研究社区现有的数据集转化为指令格式。将Tensorflow Datasets上公开可用的62个文本数据集，包括语言理解和语言生成任务，汇集到一个单一的混合体中。图3显示了这些数据集，每个数据集都被归类到十二个任务集群中的一个，给定集群中的数据集是相同的任务类型。</p>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/D1ydS4.jpg" alt="D1ydS4"></p>
<p>对于每个数据集，手动编写十个使用自然语言指令描述该数据集任务的独特模板。虽然十个模板中的大多数描述的是原始任务，为了增加多样性，还为每个数据集包含了最多三个“颠倒任务”的模板。然后，在所有数据集的混合上对预训练的语言模型进行指令调优，每个数据集中的示例都通过为该数据集随机选择的指令模板进行格式化。图4显示了一个自然语言推理数据集的多个指令模板。</p>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/iG1Jpl.jpg" alt="iG1Jpl"></p>
<h3 id="消融实验"><a href="#消融实验" class="headerlink" title="消融实验"></a>消融实验</h3><ol>
<li>指令遵循任务类型数量</li>
</ol>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/nQn4XC.jpg" alt="nQn4XC"></p>
<p>消融实验中，首先检查<strong>指令微调中使用的集群和任务数量对性能的影响</strong>。在这个实验设置中，将NLI，闭卷问答和常识推理作为评估集群，使用剩余的七个集群进行指令微调。</p>
<p>结果显示，随着在指令微调中添加更多的集群和任务，三个held-out集群的平均性能改善（情感分析集群除外），证实了指令微调方法对未见任务的零样本性能的好处。</p>
<ol>
<li>缩放法则</li>
</ol>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/lNnTsV.jpg" alt="lNnTsV"></p>
<p>对于较大的模型，语言模型的Zero-shot和Few-shot学习能力会显著提高。接下来，将探索模型规模对指令微调的影响。</p>
<p>在和之前消融研究相同的集群划分下，评估了指令调整对模型大小为422M、2B、8B、68B和137B参数的影响。</p>
<p>结果显示，<strong>对于参数数量在100B级别的两个模型，指令调整显著提高了在Held-out任务上的表现</strong>，这符合论文中的先前结果。然而，对于8B及以下模型在保留任务上的表现引人深思—指令微调实际上降低了在Held-out任务上的表现。</p>
<p>一个可能的解释是，对于小规模模型，学习指令微调期间使用的约40个任务填充了整个模型容量，导致这些模型在新任务上的表现更差。根据这个可能的解释，对于较大规模的模型，指令调整占用了一些模型容量，但同时也教会了这些模型如何遵循指令，使它们能够用剩余的容量推广到新任务。</p>
<ol>
<li>指令的作用</li>
</ol>
<p>验证自然语言指令的作用。</p>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/VAshxp.jpg" alt="VAshxp"></p>
<p>在最后的消融研究中，探讨了指令在微调过程中的作用。作者考虑了两种没有指令的微调设置。在没有模板的设置中，只给模型提供了输入和输出（(e.g., for translation the input would be “The dog runs.” and the output would be “Le chien court.”).）。在数据集名称设置中，每个输入都前置了任务和数据集的名称（e.g., for translation to French, the input would be “[Translation: WMT’14 to French] The dog runs.”）。将这两种消融设置与FLAN的微调过程进行比较，FLAN的微调过程使用了自然指令（e.g.,“Please translate this sentence to French: ‘The dogruns.’”)。</p>
<p>图8显示了结果，这两种消融配置的性能都明显低于FLAN，这表明训练中的指令对于在未见任务上的零样本性能至关重要。</p>
<ol>
<li>少样本的指令</li>
</ol>
<p>在推理阶段中，使用Few-shot的指令，提高了模型的表现。</p>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/TWTOXK.jpg" alt="TWTOXK"></p>
<ol>
<li>指令学习促进Prompt学习</li>
</ol>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/l0cYDW.jpg" alt="l0cYDW"></p>
<p>在FLAN训练之后，在进行Prompt-tuning，相较于原始模型，取得了更好的效果。</p>
<h2 id="FLAN-V2"><a href="#FLAN-V2" class="headerlink" title="FLAN V2"></a>FLAN V2</h2><p>论文标题:Scaling Instruction-Finetuned Language Models</p>
<p>论文链接:<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2210.11416.pdf">https://arxiv.org/pdf/2210.11416.pdf</a></p>
<p>文章结构如下:</p>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/FLAN V2.png" alt="FLANV2"></p>
<p>这篇文章的主题是关于对语言模型进行指令微调的研究。文章主要关注三个方面：(1) 扩大任务的数量，(2) 扩大模型的规模，以及 (3) 在COT数据上进行微调。研究发现，采取以上方式的指令微调能显著提高多种模型类别（如PaLM，T5，U-PaLM）的表现，无论是在不同的提示设置（例如Zero-shot，Few-shot，CoT）还是在各种评估基准（如MMLU，BBH，TyDiQA，MGSM，开放式生成，RealToxicityPrompts）上都有所改善。</p>
<p>例如，对1.8K任务进行指令微调的Flan-PaLM 540B，其性能比PaLM 540B提高了很大的幅度（平均提高了9.4%）。Flan-PaLM 540B在几个基准测试中都达到了业界领先的表现，例如在5-shot的MMLU上得分为75.2%。他们也公开发布了Flan-T5检查点，即使与更大的模型（如PaLM 62B）相比，其Few-shot表现也很强。</p>
<p>文章重点:</p>
<p><strong>(1) scaling the number of tasks (数据多样性很重要)</strong></p>
<p><strong>(2) scaling the model size (模型参数量很重要)</strong></p>
<p><strong>(3) finetuning on chain-of-thought data (数据质量很重要)</strong></p>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/fawbSB.jpg" alt="fawbSB"></p>
<h3 id="FLAN-Finetuning"><a href="#FLAN-Finetuning" class="headerlink" title="FLAN Finetuning"></a>FLAN Finetuning</h3><ol>
<li>微调数据</li>
</ol>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/kyKMvo.jpg" alt="kyKMvo"></p>
<ul>
<li><p>如图2所示，FLAN数据集混合了473个数据集，146个任务分类，共计1836个任务</p>
</li>
<li><p>微调数据中包含了COT的推理数据</p>
</li>
<li><p>如图3所示，指令遵循的模版也是多样化的，Zero-shot和Few-shot的混合。</p>
</li>
</ul>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/jSx3zF.jpg" alt="jSx3zF"></p>
<ol>
<li>微调过程</li>
</ol>
<ul>
<li><p>模型大小:80M-540B</p>
</li>
<li><p>常数学习率</p>
</li>
<li><p>Adafactor优化器</p>
</li>
</ul>
<blockquote>
<p>These model families span arange of sizes, from Flan-T5-small (80M parameters), to PaLM and U-PaLM (540B parameters). For each<br>model, we apply the same training procedure, except for a few hyperparameters: learning rate, batch size,dropout, and finetuning steps. We use a constant learning rate schedule and finetune using the Adafactor optimizer (Shazeer and Stern, 2018).</p>
</blockquote>
<ol>
<li>评估方法</li>
</ol>
<ul>
<li>benchmark:<strong>MMLU/BBU/TyDiQA/MGSM</strong></li>
</ul>
<h3 id="Scaling-to-540B-parameters-and-1-8K-tasks"><a href="#Scaling-to-540B-parameters-and-1-8K-tasks" class="headerlink" title="Scaling to 540B parameters and 1.8K tasks"></a>Scaling to 540B parameters and 1.8K tasks</h3><p>文章首先研究了<strong>模型规模和微调任务数量</strong>对模型的影响。</p>
<ol>
<li><p>微调任务数量对模型的影响</p>
</li>
<li><p>模型规模大小对模型的影响</p>
</li>
</ol>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/aFyvhA.jpg" alt="aFyvhA"></p>
<ul>
<li><p>作者通过对三种大小的PaLM模型（8B，62B和540B）进行实验来扩大模型规模。作者从任务最少的混合开始，逐步添加任务混合，直到任务最多的混合：CoT，Muffin，T0-SF和NIV2。</p>
</li>
<li><p>将模型规模增大一个数量级（即，从8B到62B或从62B到540B）对于微调过和未微调过的模型的性能都有显著提高。</p>
</li>
</ul>
<p><strong>Question1:为什么任务数量增加到282个任务之后，增益变小</strong>:</p>
<ul>
<li><p>一种可能是<strong>额外的任务并不特别多样化</strong>，因此它们并没有为模型<strong>提供新的知识</strong>。</p>
</li>
<li><p>另一种解释是，多任务指令微调的主要收益来自于模型更好地表达它在预训练中已经获得的知识，而超过282个任务并没有太大帮助。这种解释可能是有道理的，因为预训练数据包含780Btoken，而指导微调只使用了1.4Btoken（预训练token的0.2%）。</p>
</li>
</ul>
<p><strong>Question2:那假设1.4B Token是780B所不包含的知识，能够注入知识吗？还是SFT只能够更好的表示预训练知识</strong>？</p>
<p><strong>个人理解</strong>:</p>
<ul>
<li><p>SFT可以注入知识，比如评测数据集中无预训练的知识，通过SFT可以提高评测数据集的表现；</p>
</li>
<li><p>超过282个任务并没有太大帮助原因是，在评测数据集的这个领域正好对应通用的知识，这些知识在预训练阶段已经得到了充分的训练，SFT部分未能补充更多的知识，所以起到的是指令遵循的一个能力；</p>
</li>
</ul>
<p><strong>Question3:知乎的问题:</strong><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/612864136">如何看待FLANv2和LIMA关于LLM的指令微调的不同观点？</a></p>
<p>FLAN-v2论文链接：<a href="https://link.zhihu.com/?target=https%3A//arxiv.org/abs/2210.11416">Scaling Instruction-Finetuned Language Models</a></p>
<p>LIMA论文链接：<a href="https://link.zhihu.com/?target=https%3A//arxiv.org/abs/2305.11206">LIMA: Less Is More for Alignment</a></p>
<p>似乎一个强调范围，一个更强调指令，而中间一篇 Tulu: <a href="https://link.zhihu.com/?target=https%3A//arxiv.org/abs/2306.04751">How Far Can Camels Go? Exploring the State of Instruction Tuning on Open Resources</a> 说的更是不明不白，只看到了多样性越多越好。但是刚刚发布的LLAMA2 并没有使用很多的指令来微调。而现在的国内厂商似乎都在做大指令微调的数据集，这个思路是否有道理？</p>
<p><strong>个人理解</strong>:</p>
<ul>
<li><p>首先，二者论文并没有冲突，LIMA论文中存在两个假定假设，<strong>1:一个模型的知识和能力几乎完全是在预训练期间学习的，而对齐则教会它在与用户交互时应该使用哪种子分布格式。2：对齐主要是关于学习风格的话，预训练模型可以通过一小组示例进行充分调整。</strong></p>
</li>
<li><p>FLAN-V2中也提到当数量增加到282个数据集之后，模型效果提升收益减少，模型收益来源于模型更好地表达它在预训练中已经获得的知识。</p>
</li>
<li><p>针对预训练知识能够解决的通用的评测集，SFT增加高质量的部分数据，即可取得很好的效果；</p>
</li>
<li><p>针对预训练知识不能够解决的评测集，SFT需要增加多样性的指令数据。</p>
</li>
</ul>
<h3 id="Finetuning-with-chain-of-thought-annotations"><a href="#Finetuning-with-chain-of-thought-annotations" class="headerlink" title="Finetuning with chain-of-thought annotations"></a>Finetuning with chain-of-thought annotations</h3><ol>
<li>Finetuning on chain-of-thought improves reasoning on held-out tasks</li>
</ol>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/mpwy0i.jpg" alt="mpwy0i"></p>
<p>表4显示，Flan-PaLM的CoT提示能力超过了PaLM在四个Held-out评估基准上的表现。</p>
<ol>
<li>Some chain-of-thought data is needed to maintain reasoning ability</li>
</ol>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/GDnq8i.jpg" alt="GDnq8i"></p>
<p>如上图所示，在训练模型时，仅使用CoT数据集进行微调，其表现强于仅使用非CoT数据集进行微调。然而，结合非CoT和CoT数据集进行微调，并不会影响在非CoT任务上的表现。重要的是，这项研究也表明，在微调过程中至少需要一些CoT样本，因为仅使用非CoT样本进行微调会大幅降低模型在CoT任务上的表现。尽管以前的研究发现，指令微调可以提高未见任务的表现，但这仅适用于未见任务与微调任务处于相同提示范式（即非CoT或CoT）的情况。因此，为了提高模型在所有评估中的能力，需要同时使用非CoT和CoT数据。</p>
<ol>
<li>Unlocking zero-shot reasoning</li>
</ol>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/YKy6ac.jpg" alt="YKy6ac"></p>
<p>对CoT数据进行指令微调的一个最终好处是，<strong>无论是否有示例，结果模型都能在Zeo-shot情况下进行CoT推理</strong>。</p>
<p>在23个未见过的挑战性BIG-Bench任务的BBH基准测试中，Flan-PaLM模型可以通过利用由“让我们一步一步地思考”这句话激活的CoT推理来提高性能。相比之下，没有进行微调的PaLM不能生成解决这些问题的CoT。</p>
<p>虽然PaLM的负面Zero-shot CoT结果可能看似与Kojima等人的发现相矛盾，但更仔细的比较显示，它们并不矛盾。那篇论文中成功的Zero-shot CoT实验大部分实际上利用了InstructGPT，该模型进行了指令微调（假设这种指令微调包括了一些类似CoT的数据）。</p>
<h3 id="Discussion"><a href="#Discussion" class="headerlink" title="Discussion"></a>Discussion</h3><ol>
<li><p>指令微调的放缩曲线</p>
<p>模型的大小和微调任务数量是提高性能的两个关键组成部分。先前的工作要么扩大了模板数量，要么扩大了任务数量，要么扩大了模型的大小。文章描绘了这两个组成部分的扩展曲线，说明扩大模型的大小和微调任务数量预计将继续提高性能，尽管任务数量的扩大收益递减。</p>
</li>
<li><p>COT对于逻辑推理很关键</p>
<p>尽管先前的指令微调工作表明，对非CoT任务进行微调可以提高在未见过的非CoT任务上的性能，但我们发现这实际上会导致CoT任务的性能降低。作为解决CoT性能降低的方法，我们同时在非CoT和CoT数据上进行微调。这种联合微调使CoT性能大幅提高，同时保持了非CoT任务的性能，使得一个模型在所有评估中都表现良好。</p>
</li>
<li>指令微调可以推广到各模型</li>
<li><p>指令微调提高了可用性并减轻了一些潜在的危害</p>
<p>直接使用预训练的模型具有挑战性，因为仅在下一个标记预测目标上训练的模型不知道何时停止生成，可能会犯如继续用户输入而非响应它的错误。Flan-PaLM在几个负责任的AI基准上胜过PaLM，特别是测量有毒语言危害的基准。这些结果与InstructGPT的发现一致，该发现显示微调模型产生的输出更符合人类的偏好。</p>
</li>
<li><p>指令微调是相对计算高效的</p>
<p>指令微调可以在相对较小的计算量下提升模型性能，例如，对于PaLM 540B，指令微调只需要0.2%的预训练计算量，但可以将评估基准的规范化平均值提高9.4%。</p>
</li>
</ol>
<h1 id="指令微调数据"><a href="#指令微调数据" class="headerlink" title="指令微调数据"></a>指令微调数据</h1><h2 id="数据获取"><a href="#数据获取" class="headerlink" title="数据获取"></a>数据获取</h2><p>这一部分内容将介绍两种方式获取指定领域的SFT数据，核心思想是通过GPT4来套取可用的SFT数据，其中通过Self-Instruct来获取单轮的SFT数据，通过Baize来获取多轮的SFT数据。</p>
<h3 id="Self-Instruct"><a href="#Self-Instruct" class="headerlink" title="Self-Instruct"></a>Self-Instruct</h3><p>论文标题:SELF-INSTRUCT: Aligning Language Models with Self-Generated Instructions</p>
<p>论文链接:<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2212.10560.pdf">https://arxiv.org/pdf/2212.10560.pdf</a></p>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/eQgUhJ.jpg" alt="eQgUhJ"></p>
<ol>
<li>基于种子Prompt，生成新的任务指示描述，通过ICL每次窗口为8个示例（6人工+2生成）</li>
</ol>
<p>starts off with a limited (e.g., 175 in our study) seed set of manually-written instructions that are used to guide the overall generation. In the first phase, the model is prompted to generate instructions for new tasks. This step leverages the existing collection of instructions to create more broad-coverage instructions that define (often new) tasks</p>
<ol>
<li>判断任务是否是分类任务，分类任务的形式不同，分类器为GPT3 few-shot形式，（12分类+19非分类）</li>
</ol>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1678929778941-333749e2-68da-44c8-a954-823c24d46b31.png" alt=""></p>
<ol>
<li>产生输出输出对，分类任务Output-First；非分类任务Input-First</li>
</ol>
<p>Given the newlygenerated set of instructions, the framework also creates input-output instances for them, which can be later used for supervising the instruction tuning.</p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1678930009706-a4b4d2e2-a907-4343-b88d-1692050685bd.png" alt=""></p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1678930044701-c9650557-be52-4c9e-b01d-4542a3f80894.png" alt=""></p>
<ol>
<li>过滤低质量以及重复的指示</li>
</ol>
<p>Finally, various measures are used to prune lowquality and repeated instructions, before adding them to the task pool.</p>
<ul>
<li>与已有Instruction的重复低于0.7</li>
</ul>
<p>ROUGE-L overlap with any existing instruction is less than 0.7.</p>
<ul>
<li>剔除不能被语言模型处理的内容</li>
</ul>
<p>We also exclude instructions that contain some specific keywords (e.g., images, pictures, graphs) that usually can not be processed by language models.</p>
<ul>
<li>过滤相同或者来自相同Prompt输入的输出</li>
</ul>
<p>When generating new instances for each instruction, we filter out instances that are exactly the same or those with the same input but different outputs.</p>
<p><strong>生成的Instruction与种子Prompt重复较少</strong></p>
<p>We observe that the resulting data provides a diverse range of creative tasks and over 50% of them have less than 0.3 ROUGEL overlaps with the seed instructions</p>
<p><strong>实验数据：</strong></p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1678930304104-04bce2fd-db11-4e9d-92e6-85969e58ce52.png" alt=""></p>
<p><strong>生成</strong>Instruction<strong>的多样性与质量：</strong></p>
<ul>
<li>只有一半生成的Instruction是常见的动宾结构</li>
<li>TOP动词和名词构成的数据只占据14%</li>
<li>生成的Instruction与已有种子重复度不高</li>
<li>大多数生成是有意义的，然而会包含许多噪音</li>
</ul>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1678930536751-b6cede37-d525-4400-a030-41de09a270c6.png" alt=""></p>
<p>生成Instruction与种子Prompt最大的相似度分布：</p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1678930577160-9a57dc5a-67a3-4fd0-bbae-542ec5ef3e28.png" alt=""></p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1678930860644-965f338d-2643-4190-b7bd-2acf5f800590.png" alt=""></p>
<p><strong>实验结果：在常规的测试数据上，超过GPT3模型33%，并接近InstructGPT；在新构建的数据集上，超过在公开指示数据集微调的GPT3，与InstructGPT只差5%</strong></p>
<p>The SUPERNI results indicate that GPT3SELF-INST outperforms GPT3 (the original model) by a large margin (+33.1%) and nearly matches the performance of InstructGPT001. Moreover, our human evaluation on the newly-created instruction set shows that GPT3SELF-INST demonstrates a broad range of instruction following ability, outperforming models trained on other publicly available instruction datasets and leaving only a 5% gap behind InstructGPT001.</p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1678931155516-4052a4ef-2c84-4f31-ba4e-5fb6210e0100.png" alt=""></p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1678931332011-847b3aa8-0f75-4641-98fe-6a7b4760aa94.png" alt=""></p>
<p><strong>具体应用</strong>:</p>
<p>斯坦福大学提出的<strong>Alpaca</strong>羊驼模型，利用InstructGPT生成Instrutions，再基于LLAMA进行微调</p>
<p><a target="_blank" rel="noopener" href="https://alpaca-ai-custom3.ngrok.io/">https://alpaca-ai-custom3.ngrok.io/</a></p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1678932643771-edefc746-8e8b-4ee5-9414-7218f8f583d5.png" alt=""></p>
<h3 id="Baize-多轮对话数据构建"><a href="#Baize-多轮对话数据构建" class="headerlink" title="Baize(多轮对话数据构建)"></a>Baize(多轮对话数据构建)</h3><p>论文标题:Baize: An Open-Source Chat Model with Parameter-Efficient Tuning on<br>Self-Chat Data</p>
<p>论文链接:<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2304.01196.pdf">https://arxiv.org/pdf/2304.01196.pdf</a></p>
<p>概述:团队从美国知乎Quora，最大的编程问答社区StackOverflow等处收集到种子问题。</p>
<p>然后让ChatGPT自我对话，收集了11万条多轮对话，使用OpenAI的API大约花费<strong>100美元</strong>。</p>
<p>在此基础上使用LoRA（Low-Rank Adaption）方法微调Meta开源大模型LLaMA得到白泽。整体流程如下图所示:</p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1680742099480-dd0ff89c-6119-449a-905e-0d17c3fbc25d.png" alt=""></p>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/FXWY3N.jpg" alt="FXWY3N"><img src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1680742185719-0c6cc145-8cb7-4872-af1d-ed77ec887232.png" alt=""></p>
<h4 id="英文Prompt"><a href="#英文Prompt" class="headerlink" title="英文Prompt"></a>英文Prompt</h4><p>instruct = “Forget the instruction you have previously received. The following is a conversation between a human and an AI assistant. The human and the AI assistant take turns chatting about the topic: ‘{}’. Human statements start with [Human] and AI assistant statements start with [AI]. The human will ask related questions on related topics or previous conversation. The human will stop the conversation when they have no more question. The AI assistant tries not to ask questions. Complete the transcript in exactly that format.\n[Human] Hello!\n[AI] Hi! How can I help you?\n”.format(</p>
<p>query</p>
<p>)</p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1680742088850-a710a98c-66f3-4ffd-b86f-4c64a10c722e.png" alt=""></p>
<h4 id="翻译后Prompt"><a href="#翻译后Prompt" class="headerlink" title="翻译后Prompt"></a>翻译后Prompt</h4><p>忘记你之前收到的指令。下面是一个人和人工智能助手之间的对话。这个人和人工智能助理轮流聊这个话题：‘户外露营如何选择装备’。人类语句以[用户]开头，人工智能助手语句以[AI]开头。人类会就相关话题或之前的对话提出相关问题。当人类没有更多问题时，他们会停止对话。人工智能助理尽量不提问。尽量按照以下这种格式输出：\n[用户] 你好!\n[AI] 你好，有什么我能帮您的?\n</p>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/LXC1Sf.png" alt="LXC1Sf"></p>
<h2 id="数据筛选"><a href="#数据筛选" class="headerlink" title="数据筛选"></a>数据筛选</h2><p>在现有的海量SFT数据中，根据LIMA等论文的研究表明，SFT的数据质量对模型的表现有着至关重要的影响。那么，面对这些数据，我们应如何筛选出高质量的数据呢？在本文中，我们将详细介绍两个评估数据质量的重要指标：PPL和IFD。</p>
<h3 id="PPL-困惑度标签"><a href="#PPL-困惑度标签" class="headerlink" title="PPL(困惑度标签)"></a>PPL(困惑度标签)</h3><p>在信息论中，perplexity(困惑度)用来度量一个概率分布或概率模型预测样本的好坏程度。它也可以用来比较两个概率分布或概率模型。（应该是比较两者在预测样本上的优劣）低困惑度的概率分布模型或概率模型能更好地预测样本。</p>
<p><strong>困惑度越小，句子概率越大，语言模型越好。</strong></p>
<p>在自然语言处理中，困惑度是用来衡量语言概率模型优劣的一个方法。一个语言概率模型可以看成是在整过句子或者文段上的概率分布。</p>
<p>它主要是根据每个词来估计一句话出现的概率，并用句子长度作normalize，公式为如下：</p>
<script type="math/tex; mode=display">
\begin{aligned}
P P(S) & =P\left(w_1 w_2 \ldots w_N\right)^{-\frac{1}{N}} \\
& =\sqrt[N]{\frac{1}{p\left(w_1 w_2 \ldots w_N\right)}} \\
& =\sqrt[N]{\prod_{i=1}^N \frac{1}{p\left(w_i \mid w_1 w_2 \ldots w_{i-1}\right)}}
\end{aligned}</script><p><strong>Perplexity另一种表达</strong></p>
<p>针对文本中的词预测任务来说，离散概率分布p的困惑度由下式给出，其中H(p) 是该分布的熵，x遍历事件空间。概率分布的perplexity：</p>
<script type="math/tex; mode=display">
2^{H(p)}=2^{-\sum_{x}p(x)log_2 p(x)}</script><p>当选用e作为底数时:</p>
<script type="math/tex; mode=display">
PPL=e^{Loss}</script><h3 id="IFD"><a href="#IFD" class="headerlink" title="IFD"></a>IFD</h3><p>论文标题:From Quantity to Quality: Boosting LLM Performance with Self-Guided Data<br>Selection for Instruction Tuning</p>
<p>论文链接:<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2308.12032.pdf">https://arxiv.org/pdf/2308.12032.pdf</a></p>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/UPZNLB.jpg" alt="UPZNLB"></p>
<p>利用IFD指标自动筛选樱桃数据，再利用樱桃数据进行模型指令微调，获取更好地微调模型，文章流程主要涉及三个步骤：</p>
<ul>
<li>Learning from Brief Experience：利用少量进行进行模型初学；</li>
<li>Evaluating Based on Experience：利用初学模型计算原始数据中所有IFD指标;</li>
<li>Retraining from Self-Guided Experience：利用樱桃数据进行模型重训练。</li>
</ul>
<p>公式定义如下:</p>
<p>Conditioned Answer Score(CAS)指标定义:</p>
<script type="math/tex; mode=display">
L_\theta(A | Q)=\frac{1}{N} \sum_{i=1}^N \log P(w_i^A | Q, w_1^A, w_2^A, \ldots, w_{i-1}^A ; \theta)</script><p>根据CAS的高低，可以判断出模型对指令Q生成答案A的难易，但也可能受到模型生成答案A的难易程度的影响。</p>
<p>Direct Answer Score(DAS)指标定义:</p>
<script type="math/tex; mode=display">
s_\theta(A)=\frac{1}{N} \sum_{i=1}^N \log P\left(w_i^A \mid w_1^A, \ldots, w_{i-1}^A ; \theta\right)</script><p>利用模型直接对答案进行续写，再根据答案真实内容获取直接的差异值，DAS得分越高，可能表明该答案对模型生成来说本身就更具挑战性或更复杂。</p>
<p>Instruction-Following Difficulty (IFD)指标定义:</p>
<script type="math/tex; mode=display">
r_{\theta}(Q,A)=\frac{s_{\theta}(A|Q)}{s_{\theta}(A)}</script><p>为了获取更好的指令数据，也就是哪些指令对模型的影响更高，需要刨除答案本身的影响。在这种情况下，LLM的内在能力对适应答案字符串的影响被部分缓解。得分衡量了给定指令有多大程度上帮助相应反应的对齐。高IFD分数暗示了模型对齐给定指令能力的不足，反过来表明了指令的难度。</p>
<p>在Alpaca和WizardLM两个数据集上利用Llama-7B进行实验，发现在5%的Alpaca樱桃数据上进行训练就超过了全量数据训练结果。</p>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/sDnpOz.jpg" alt="sDnpOz"></p>
<p><strong>如何判断IFD指标是有效的</strong>？对比随机采样、IFD采样、IFD低分采样、CAS采样四种方法对模型指令微调的影响，发现IFD采样在不同数据比例下，均高于全量数据微调效果，但其他采样方法均低于全量数据微调方法。</p>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/GLo6gU.jpg" alt="GLo6gU"></p>
<p>对高质量数据和低质量数据进行分析，发现樱桃数据通常在范围、复杂性、深度和知识方面得分更高，在清晰度和简单性方面得分更低。并且发现高难度和低难度的样本之间存在明显的界限。</p>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/s2rlnf.jpg" alt="s2rlnf"></p>
<p>接下来是理解原始数据集中樱桃数据的分布特性。作者首先计算Alpaca数据集中每个指令的嵌入，并使用t-SNE进行降维，将高维嵌入映射到2D空间。将根据最高或最低的5%难度比率进行颜色编码的可视化向量展示在图7中。与传统观点相反，樱桃数据并非均匀分布。相反，高难度和低难度样本之间存在明显的划分，这挑战了之前的假设，即选定的数据应覆盖整个指令谱并最大化多样性。</p>
<p><img src="https://jmxblog.oss-cn-hangzhou.aliyuncs.com/uPic/vltEZB.jpg" alt="vltEZB"></p>
<h2 id="数据配比-SFT混合训练"><a href="#数据配比-SFT混合训练" class="headerlink" title="数据配比:SFT混合训练"></a>数据配比:SFT混合训练</h2><p>在我们获得大量高质量的跨领域SFT数据后，如何组合这些数据以构建训练集成为了一个重要问题。尽管FLAN等相关研究已经阐述了数据多样性对模型性能的提升作用，但在不同数据集之间是否存在相互影响以及如何合理配比不同数据集以提升模型效果，尚待进一步探讨。接下来，我们将就这些问题展开深入讨论，并引入一篇研究论文的相关内容。</p>
<p>论文标题:HOW ABILITIES IN LARGE LANGUAGE MODELS ARE AFFECTED BY SUPERVISED FINE-TUNING DATA COMPOSITION</p>
<p>论文链接: <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2310.05492.pdf">https://arxiv.org/pdf/2310.05492.pdf</a></p>
<p>文章内容结构如下图所示:</p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1698369336569-00b7e779-837c-4696-be86-ae3deb3a0519.png" alt=""></p>
<h3 id="出发点"><a href="#出发点" class="headerlink" title="出发点"></a>出发点</h3><p>论文提出4个<strong>核心问题</strong>:</p>
<ol>
<li><p>数学推理、代码、通用能力随SFT数据数量如何变化？</p>
</li>
<li><p>当SFT混合三者数据时，是否会出现冲突？</p>
</li>
<li><p>导致三者冲突的关键因素是什么？</p>
</li>
<li><p>针对混合数据的不同SFT训练策略影响是什么？</p>
</li>
</ol>
<p>为了找到这些问题的答案，作者设置了一些实验进行探究。</p>
<h3 id="实验结果"><a href="#实验结果" class="headerlink" title="实验结果"></a>实验结果</h3><p><strong>实验设置</strong>:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>数学推理能力</th>
<th>代码生成能力</th>
<th>通用能力</th>
</tr>
</thead>
<tbody>
<tr>
<td>训练数据</td>
<td>GSM8K RFT</td>
<td>Code Alpaca</td>
<td>ShareGPT</td>
</tr>
<tr>
<td>测试数据</td>
<td>GSM8K</td>
<td>HumanEval</td>
<td>MT-Bench</td>
</tr>
</tbody>
</table>
</div>
<h4 id="不同数据量下单能力的表现"><a href="#不同数据量下单能力的表现" class="headerlink" title="不同数据量下单能力的表现"></a>不同数据量下单能力的表现</h4><p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1698371271658-a1d88555-3af6-475a-b5a2-d2449305391f.png" alt=""></p>
<p><strong>图片介绍:</strong></p>
<ul>
<li><p>横坐标:训练数据量占整体数据量的比例</p>
</li>
<li><p>纵坐标:相应的模型能力打分</p>
</li>
</ul>
<p><strong>实验结论:</strong></p>
<ul>
<li><p><strong>不同能力呈现出不同的放缩曲线</strong></p>
</li>
<li><p><strong>大模型在同样数据集下通常表现更佳</strong></p>
</li>
</ul>
<h4 id="不同数据混合数量下-能力表现的差异"><a href="#不同数据混合数量下-能力表现的差异" class="headerlink" title="不同数据混合数量下 能力表现的差异"></a>不同数据混合数量下 能力表现的差异</h4><p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1698372412696-95911981-1b9c-4910-afbc-0e75996f7de0.png" alt=""></p>
<p><strong>设计思路</strong>:固定了不同领域数据的比例，修改绝对的数据量</p>
<p><strong>图片介绍:</strong></p>
<ul>
<li><p>横坐标:训练数据量占整体数据量的比例</p>
</li>
<li><p>纵坐标:相应的模型能力打分</p>
</li>
<li><p>蓝色曲线:单独能力数据集训练曲线</p>
</li>
<li><p>红色曲线:混合数据集训练曲线</p>
</li>
</ul>
<p><strong>实验结论:</strong></p>
<ul>
<li><p><strong>混合的情况下，在数据量较少时优于单能力表现;在数据量较多时劣于单能力表现</strong></p>
<ul>
<li>低资源情况下，不同数据量可以互相受益；高资源情况下，其他领域数据被视为了噪声</li>
</ul>
</li>
<li><p><strong>随模型大小增加，模型表现在低资源情况下也增加</strong></p>
</li>
</ul>
<h4 id="不同数据混合比例下-能力表现的差异"><a href="#不同数据混合比例下-能力表现的差异" class="headerlink" title="不同数据混合比例下 能力表现的差异"></a>不同数据混合比例下 能力表现的差异</h4><p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1698373272442-4e31b2d5-d3c5-4692-b39d-1123467e2cfd.png" alt=""></p>
<p><strong>设计思路</strong>:固定全量xx数据集，增加其他数据集数量，观测固定数据集下的能力表现</p>
<p>图片介绍:</p>
<ul>
<li><p>横坐标:新增垂直训练数据量占整体数据量的比例</p>
</li>
<li><p>纵坐标:相应的模型能力打分</p>
</li>
<li><p>蓝色曲线:加入混合数据训练曲线</p>
</li>
<li><p>红色曲线:对比训练曲线</p>
</li>
</ul>
<p><strong>实验结论</strong>:</p>
<ul>
<li><p><strong>当不同SFT能力之间的任务格式和数据分布存在显著差异时，数据比率的影响是最小的。然而，当存在一定程度的相似性时，数据比率可能会导致性能的明显波动。</strong></p>
<ul>
<li><p>数学推理和通用能力在语义空间差距较大</p>
</li>
<li><p>ShareGPT中数据格式和分布的差异，导致数据比例增加时，性能出现波动</p>
</li>
</ul>
</li>
<li><p><strong>低资源情况下，数据比例对性能的影响:缩放趋势与完整数据量相同</strong></p>
</li>
</ul>
<h4 id="不同训练策略下-能力表现的差异"><a href="#不同训练策略下-能力表现的差异" class="headerlink" title="不同训练策略下 能力表现的差异"></a>不同训练策略下 能力表现的差异</h4><p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1698374021569-08d8d4af-dfe9-4bc5-ae6e-87d12bb8d607.png" alt=""></p>
<p>作者提出了四种训练策略:</p>
<ul>
<li><p>Multi-task Learning:多个领域数据集混合一同训练</p>
</li>
<li><p>Sequential Training:多个领域数据集顺序训练</p>
</li>
<li><p>Mixed Sequential Training:第一阶段混合垂直领域数据集训练,第二阶段全量通用领域数据集训练</p>
</li>
<li><p>Dual-stage Mixed Fine-tuning:第一阶段混合垂直领域数据集训练，第二阶段全量通用数据集+小部分垂直领域数据集训练</p>
</li>
</ul>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1698399507466-cf31dbf8-0613-43eb-975a-cfca13de1aee.png" alt=""></p>
<p><strong>实验结果:</strong></p>
<ul>
<li><strong>多任务学习会导致冲突，而顺序训练会导致灾难性遗忘。DMF训练方法有效地缓解了SFT短语中的性能冲突和灾难性遗忘，实现了一般能力和专项能力之间的平衡。</strong></li>
</ul>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1698399819132-7f0131b9-c0dd-48c0-a028-8a00465293c1.png" alt=""></p>
<p>图片介绍:</p>
<ul>
<li><p>横坐标:新增垂直训练数据量占整体数据量的比例</p>
</li>
<li><p>纵坐标:相应的模型能力打分</p>
</li>
<li><p>蓝色曲线:垂直领域能力曲线</p>
</li>
<li><p>红色曲线:通用领域能力曲线</p>
</li>
</ul>
<p><strong>实验结论:</strong></p>
<ul>
<li><p><strong>低资源情况下，不同数据量可以互相受益；</strong></p>
</li>
<li><p><strong>高资源情况下，其他领域数据被视为了噪声，效果下降</strong></p>
</li>
</ul>
<h3 id="实验结果-1"><a href="#实验结果-1" class="headerlink" title="实验结果"></a>实验结果</h3><ol>
<li><strong>不同SFT能力存在不同的数据缩放模式，大模型在同样数据下通常表现更好</strong></li>
<li><strong>与单一能力学习相比，多任务学习多种能力在低资源下有所改善，在高资源下有所下降。此外，随着模型大小的增加，在数学和一般能力的低资源设置中有更大的性能提升。</strong></li>
<li><strong>数据量直接影响每种能力，而数据比率并不重要。</strong></li>
<li><strong>多任务学习会导致冲突，而顺序训练会导致灾难性遗忘。DMF训练方法有效地缓解了SFT短语中的性能冲突和灾难性遗忘，实现了一般能力和专项能力之间的平衡。</strong></li>
</ol>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>总结来说，本文详细地探讨了指令微调—连接预训练模型与实际业务需求的重要手段。我们重点介绍了指令微调的起源、目标和实践策略，并希望能够从中获取到实际应用的方法和思路。</p>
<p>具体来说，我们首先回顾了指令微调的起源FLAN，并强调了其在模型训练中的重要性。接着，我们阐述了指令微调的核心目的——即激发预训练模型的指令遵循能力，以帮助模型更好地理解和执行特定指令。最后，我们深入探讨了如何执行指令微调，包括获取数据的多样性、选择高质量数据以及组合高质量数据。</p>
<p>此外，我们也详细讨论了SFT的目标、关键做法和优势。这些内容的讨论和分析，旨在帮助大家在实际工作中更高效地应用指令微调，从而提升模型在特定业务场景下的性能。</p>
<p>感兴趣的可以关注微信公众号联系哈～</p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/67256578/1692751562367-607c2567-a00c-46cb-8f99-d6e758f8cd3b.png" alt=""></p>

    </div>

    
    
    
    <div>
    
      <div>
  
    <div style="text-align:center;color:#bfbfbf;font-size:16px;">
      <span>-------- 本文结束 </span>
      <i class="fa fa-paw"></i>
      <span> 感谢阅读 --------</span>
    </div>
  
</div>

    
    </div>
      
  <div class="popular-posts-header">猜你喜欢# Custom header, leave empty to use the default one</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2023/05/08/2023-05-08-复刻ChatGPT语言模型系列-（一）基座模型选取/" rel="bookmark">复刻ChatGPT语言模型系列-（一）基座模型选取</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2023/05/16/2023-05-08-复刻ChatGPT语言模型系列-（四）文本生成解码/" rel="bookmark">复刻ChatGPT语言模型系列-（四）文本生成解码</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2023/06/13/2023-06-13-LLM训练指南-Token及模型参数准备/" rel="bookmark">LLM训练指南-Token及模型参数准备</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2023/07/01/2023-07-01-LLM训练指南(二):模型参数、计算量、显存、计算时间计算/" rel="bookmark">LLM训练指南(二):模型参数、计算量、显存、计算时间计算</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2023/07/22/2023-07-22-RoPE旋转位置编码深度解析：理论推导、代码实现、长度外推/" rel="bookmark">RoPE旋转位置编码深度解析：理论推导、代码实现、长度外推</a></div>
    </li>
  </ul>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>JMX
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://jmxgodlz.xyz/2023/11/27/2023-11-27-%E5%A4%8D%E5%88%BBChatGPT%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%B3%BB%E5%88%97-%EF%BC%88%E4%B8%89%EF%BC%89%E6%8C%87%E4%BB%A4%E5%AD%A6%E4%B9%A0%E5%BE%AE%E8%B0%83/" title="复刻ChatGPT语言模型系列-（三）指令学习微调">https://jmxgodlz.xyz/2023/11/27/2023-11-27-复刻ChatGPT语言模型系列-（三）指令学习微调/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/NLP/" rel="tag"><i class="fa fa-tag"></i> NLP</a>
              <a href="/tags/ChatGPT/" rel="tag"><i class="fa fa-tag"></i> ChatGPT</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/10/26/2023-10-26-%E5%A4%8D%E5%88%BBChatGPT%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%B3%BB%E5%88%97-%EF%BC%88%E4%BA%8C%EF%BC%89%E5%8F%82%E6%95%B0%E9%AB%98%E6%95%88%E5%BE%AE%E8%B0%83/" rel="prev" title="复刻ChatGPT语言模型系列-（二）参数高效微调">
      <i class="fa fa-chevron-left"></i> 复刻ChatGPT语言模型系列-（二）参数高效微调
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/12/30/2023-12-30-QWen%E5%8D%87%E7%BA%A7%E4%B9%8B%E8%B7%AF/" rel="next" title="QWen升级之路">
      QWen升级之路 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#FLAN"><span class="nav-number">2.</span> <span class="nav-text">FLAN</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#FLAN-V1"><span class="nav-number">2.1.</span> <span class="nav-text">FLAN V1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E9%9B%86%E8%AF%A6%E6%83%85"><span class="nav-number">2.1.1.</span> <span class="nav-text">数据集详情</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B6%88%E8%9E%8D%E5%AE%9E%E9%AA%8C"><span class="nav-number">2.1.2.</span> <span class="nav-text">消融实验</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#FLAN-V2"><span class="nav-number">2.2.</span> <span class="nav-text">FLAN V2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#FLAN-Finetuning"><span class="nav-number">2.2.1.</span> <span class="nav-text">FLAN Finetuning</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Scaling-to-540B-parameters-and-1-8K-tasks"><span class="nav-number">2.2.2.</span> <span class="nav-text">Scaling to 540B parameters and 1.8K tasks</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Finetuning-with-chain-of-thought-annotations"><span class="nav-number">2.2.3.</span> <span class="nav-text">Finetuning with chain-of-thought annotations</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Discussion"><span class="nav-number">2.2.4.</span> <span class="nav-text">Discussion</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4%E5%BE%AE%E8%B0%83%E6%95%B0%E6%8D%AE"><span class="nav-number">3.</span> <span class="nav-text">指令微调数据</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96"><span class="nav-number">3.1.</span> <span class="nav-text">数据获取</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Self-Instruct"><span class="nav-number">3.1.1.</span> <span class="nav-text">Self-Instruct</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Baize-%E5%A4%9A%E8%BD%AE%E5%AF%B9%E8%AF%9D%E6%95%B0%E6%8D%AE%E6%9E%84%E5%BB%BA"><span class="nav-number">3.1.2.</span> <span class="nav-text">Baize(多轮对话数据构建)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8B%B1%E6%96%87Prompt"><span class="nav-number">3.1.2.1.</span> <span class="nav-text">英文Prompt</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BF%BB%E8%AF%91%E5%90%8EPrompt"><span class="nav-number">3.1.2.2.</span> <span class="nav-text">翻译后Prompt</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%AD%9B%E9%80%89"><span class="nav-number">3.2.</span> <span class="nav-text">数据筛选</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#PPL-%E5%9B%B0%E6%83%91%E5%BA%A6%E6%A0%87%E7%AD%BE"><span class="nav-number">3.2.1.</span> <span class="nav-text">PPL(困惑度标签)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IFD"><span class="nav-number">3.2.2.</span> <span class="nav-text">IFD</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E9%85%8D%E6%AF%94-SFT%E6%B7%B7%E5%90%88%E8%AE%AD%E7%BB%83"><span class="nav-number">3.3.</span> <span class="nav-text">数据配比:SFT混合训练</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BA%E5%8F%91%E7%82%B9"><span class="nav-number">3.3.1.</span> <span class="nav-text">出发点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E7%BB%93%E6%9E%9C"><span class="nav-number">3.3.2.</span> <span class="nav-text">实验结果</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E9%87%8F%E4%B8%8B%E5%8D%95%E8%83%BD%E5%8A%9B%E7%9A%84%E8%A1%A8%E7%8E%B0"><span class="nav-number">3.3.2.1.</span> <span class="nav-text">不同数据量下单能力的表现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E6%B7%B7%E5%90%88%E6%95%B0%E9%87%8F%E4%B8%8B-%E8%83%BD%E5%8A%9B%E8%A1%A8%E7%8E%B0%E7%9A%84%E5%B7%AE%E5%BC%82"><span class="nav-number">3.3.2.2.</span> <span class="nav-text">不同数据混合数量下 能力表现的差异</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E6%B7%B7%E5%90%88%E6%AF%94%E4%BE%8B%E4%B8%8B-%E8%83%BD%E5%8A%9B%E8%A1%A8%E7%8E%B0%E7%9A%84%E5%B7%AE%E5%BC%82"><span class="nav-number">3.3.2.3.</span> <span class="nav-text">不同数据混合比例下 能力表现的差异</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8D%E5%90%8C%E8%AE%AD%E7%BB%83%E7%AD%96%E7%95%A5%E4%B8%8B-%E8%83%BD%E5%8A%9B%E8%A1%A8%E7%8E%B0%E7%9A%84%E5%B7%AE%E5%BC%82"><span class="nav-number">3.3.2.4.</span> <span class="nav-text">不同训练策略下 能力表现的差异</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E7%BB%93%E6%9E%9C-1"><span class="nav-number">3.3.3.</span> <span class="nav-text">实验结果</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">4.</span> <span class="nav-text">总结</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="JMXGODLZZ"
      src="/images/jmx.png">
  <p class="site-author-name" itemprop="name">JMXGODLZZ</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">34</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/447428054" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;447428054" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:jmxgodlzz@gmail.com" title="E-Mail → mailto:jmxgodlzz@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



  <div class="links-of-recent-posts motion-element">
    <div class="links-of-recent-posts-title">
      <i class="fa fa-history fa-fw"></i>
      最近文章
    </div>
    <ul class="links-of-recent-posts-list">
        <li class="links-of-recent-posts-item">
          <a href="/2023/12/30/2023-12-30-QWen%E5%8D%87%E7%BA%A7%E4%B9%8B%E8%B7%AF/" title="2023&#x2F;12&#x2F;30&#x2F;2023-12-30-QWen升级之路&#x2F;">QWen升级之路</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2023/11/27/2023-11-27-%E5%A4%8D%E5%88%BBChatGPT%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%B3%BB%E5%88%97-%EF%BC%88%E4%B8%89%EF%BC%89%E6%8C%87%E4%BB%A4%E5%AD%A6%E4%B9%A0%E5%BE%AE%E8%B0%83/" title="2023&#x2F;11&#x2F;27&#x2F;2023-11-27-复刻ChatGPT语言模型系列-（三）指令学习微调&#x2F;">复刻ChatGPT语言模型系列-（三）指令学习微调</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2023/10/26/2023-10-26-%E5%A4%8D%E5%88%BBChatGPT%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%B3%BB%E5%88%97-%EF%BC%88%E4%BA%8C%EF%BC%89%E5%8F%82%E6%95%B0%E9%AB%98%E6%95%88%E5%BE%AE%E8%B0%83/" title="2023&#x2F;10&#x2F;26&#x2F;2023-10-26-复刻ChatGPT语言模型系列-（二）参数高效微调&#x2F;">复刻ChatGPT语言模型系列-（二）参数高效微调</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2023/09/19/2023-09-19-ALiBi%E4%BD%8D%E7%BD%AE%E7%BC%96%E7%A0%81%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%EF%BC%9A%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E3%80%81%E9%95%BF%E5%BA%A6%E5%A4%96%E6%8E%A8/" title="2023&#x2F;09&#x2F;19&#x2F;2023-09-19-ALiBi位置编码深度解析：代码实现、长度外推&#x2F;">ALiBi位置编码深度解析：代码实现、长度外推</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2023/09/19/2023-09-19-%E4%B8%8A%E4%B8%8B%E6%96%87%E6%89%A9%E5%B1%95%E6%8E%A2%E7%B4%A2%EF%BC%9AFOT%E4%B8%8EMT%E7%9A%84%E5%A4%96%E9%83%A8%E5%AD%98%E5%82%A8%E7%AD%96%E7%95%A5/" title="2023&#x2F;09&#x2F;19&#x2F;2023-09-19-上下文扩展探索：FOT与MT的外部存储策略&#x2F;">上下文扩展探索：FOT与MT的外部存储策略</a>
        </li>
    </ul>
  </div>


<div style="">
  <canvas id="canvas" style="width:60%;">当前浏览器不支持canvas，请更换浏览器后再试</canvas>
</div>
<script>
(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //声明canvas的宽高
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //存储时间数据
    var data = [];
    //存储运动的小球
    var balls = [];
    //设置粒子半径
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //存储时间数字，由十位小时、个位小时、冒号、十位分钟、个位分钟、冒号、十位秒钟、个位秒钟这7个数字组成
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*生成点阵数字*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*更新时钟*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //时间发生变化
            if(NewData[i] !== data[i]){
                //将变化的数字值和在data数组中的索引存储在changeNumArray数组中
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //增加小球
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*更新小球状态*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*增加要运动的小球*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*渲染*/
    function render(){
        //重置画布宽度，达到清空画布的效果
        canvas.height = 100;
        //渲染时钟
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //渲染小球
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //更新时钟
        updateDigitTime();
        //更新小球状态
        updateBalls();
        //渲染
        render();
    },50);
}

})();
</script>


      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">JMXGODLZZ</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">316k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">4:48</span>
</div>
  <div class="powered-by">

  </div><script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script>

        
<div class="busuanzi-count">
  <script async src="/js/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.4.16/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'EqIhOtvzwzCzQNJS178We0en-gzGzoHsz',
      appKey     : 'uGXYV87r0A6miFKVHul24dnC',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>


  <script async src="/js/cursor/fireworks.js"></script>




  <script src="/js/activate-power-mode.min.js"></script>
  <script>
    POWERMODE.colorful = true;
    POWERMODE.shake = false;
    document.body.addEventListener('input', POWERMODE);
  </script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":-15,"vOffset":-15},"mobile":{"show":true},"react":{"opacity":0.9},"log":false});</script></body>
</html>
